<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>APS3E Compatibility List</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>APS3E Compatibility List</h1>

<div class="tags" id="tags"></div>

<table id="compatibility">
<thead>
<tr>
<th>Title ID</th>
<th>Entry Name</th>
<th>Status</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="update" id="lastUpdate"></div>

<script>
fetch("data/games.json")
  .then(res => res.json())
  .then(data => {
    const totalGames = data.games.length;
    const tagCounts = {};
    data.tags.forEach(tag => tagCounts[tag.name] = 0);
    data.games.forEach(game => { if(tagCounts.hasOwnProperty(game.status)) tagCounts[game.status]++; });

    // Теги сверху
    const tagsDiv = document.getElementById("tags");
    data.tags.forEach(tag => {
      const count = tagCounts[tag.name] || 0;
      const percent = ((count / totalGames) * 100).toFixed(2) + "%";
      const div = document.createElement("div");
      div.className = "tag " + tag.name;
      div.innerText = `${tag.name} (${percent})`;
      div.title = tag.description;
      tagsDiv.appendChild(div);
    });

    // Таблица
    const tbody = document.querySelector("#compatibility tbody");
    data.games.forEach(game => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${game.id}</td>
        <td>${game.name}</td>
        <td class="status ${game.status}">${game.status}</td>
      `;
      tbody.appendChild(tr);
    });

    // Last Updated
    document.getElementById("lastUpdate").innerText = "Last Updated at: " + data.lastUpdated;
  })
  .catch(err => console.error("Ошибка загрузки данных:", err));
</script>

</body>
</html>
